{% extends "base.html" %}

{% block title %}Agregar Factura{% endblock %}

{% block content %}
    <h1 class="mt-5">Agregar Factura</h1>
    <form action="/agregar_factura" method="POST">
        <div class="mb-3">
            <label for="cliente" class="form-label">Cliente</label>
            <select class="form-select" id="cliente" name="cliente" required>
                {% for cliente in clientes %}
                <option value="{{ cliente[0] }}">{{ cliente[1] }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="mb-3">
            <label for="sucursal" class="form-label">Sucursal</label>
            <input type="text" class="form-control" id="sucursal" name="sucursal" required>
        </div>
        <div class="mb-3">
            <label for="fecha" class="form-label">Fecha</label>
            <input type="date" class="form-control" id="fecha" name="fecha" required>
        </div>
        
        <h3>Productos</h3>
        {% for producto in productos %}
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="producto_{{ producto[0] }}" name="productos" value="{{ producto[0] }}">
            <label class="form-check-label" for="producto_{{ producto[0] }}">{{ producto[1] }} - Precio: {{ producto[2] }}</label>
            <input type="hidden" name="precio_{{ producto[0] }}" value="{{ producto[2] }}">
        </div>
        {% endfor %}
        
        <div class="mb-3">
            <label for="total" class="form-label">Total</label>
            <input type="number" step="0.01" class="form-control" id="total" name="total" readonly>
        </div>
        
        <button type="submit" class="btn btn-primary">Agregar</button>
    </form>

    <script>
        // Calcular el total al seleccionar/deseleccionar los productos
        var checkboxes = document.querySelectorAll('input[name="productos"]');
        var totalInput = document.getElementById('total');
        checkboxes.forEach(function(checkbox) {
            checkbox.addEventListener('change', function() {
                var total = 0;
                checkboxes.forEach(function(checkbox) {
                    if (checkbox.checked) {
                        var precio = parseFloat(document.querySelector('input[name="precio_' + checkbox.value + '"]').value);
                        total += precio;
                    }
                });
                totalInput.value = total.toFixed(2);
            });
        });
    </script>
{% endblock %}


